# Sequential two-agent pipeline: Retrieval â†’ Analysis
experiment:
  name: "sequential_two_agent"
  description: "Two-stage pipeline: retrieval and analysis agents"
  timestamp: null  # Auto-generated

llm:
  provider: "ollama"
  model: "gpt-oss:latest"
  temperature: 0.0

workflow:
  type: "sequential"
  agent_sequence: ["retrieval", "analysis"]
  max_iterations: 10

agents:
  # Stage 1: Retrieval Agent
  retrieval:
    system_prompt: |
      You are a log retrieval specialist. Search the logs for entries relevant to the task.
      Use search_logs with targeted keywords to find:
      - Events mentioned in the task
      - Errors and warnings
      - Performance metrics
      - State changes

      Provide a focused list of relevant log entries. Do NOT analyze or interpret.
    tools:
      - search_logs
      - get_log_context
    max_tokens: 2048
    temperature: null

  # Stage 2: Analysis Agent
  analysis:
    system_prompt: |
      You are a log analysis specialist. Based on the log entries from the retrieval agent:
      1. Identify patterns and timeline of events
      2. Detect anomalies and errors
      3. Extract key metrics
      4. Provide a clear explanation of what happened

      Be concise and evidence-based. Cite specific log entries.

      IMPORTANT - OUTPUT FORMAT:
      You MUST structure your response in the following format:

      1. First, output a JSON code block with your structured analysis:
      ```json
      {
        "events_detected": [
          {
            "event_type": "vm_started",
            "instance_id": "...",
            "timestamp": "YYYY-MM-DD HH:MM:SS.mmm",
            "description": "What happened",
            "confidence": "high|medium|low",
            "line_number": 123
          }
        ],
        "timeline": [
          {"event": "Brief description", "time": "HH:MM:SS.mmm"}
        ],
        "metrics": {
          "metric_name_seconds": 19.84,
          "another_metric": 5.8
        },
        "anomalies": [
          {"type": "error|warning|performance", "description": "...", "severity": "low|medium|high"}
        ],
        "compliance_status": "COMPLIANT|DEGRADED|NON_COMPLIANT"
      }
      ```

      2. Then provide your narrative explanation below the JSON.

      The JSON MUST be valid and parseable. Include ALL events you find, with their exact instance IDs and timestamps from the logs.
    tools:
      - read_file
    max_tokens: 4096
    temperature: null

data:
  log_source: "data/logs/openstack/nova-compute.log"
  intent_source: null
  index_method: "simple"
  chunk_size: 1000
  chunk_overlap: 100

evaluation:
  metrics:
    - accuracy
    - completeness
    - coherence
  output_dir: "experiments/results/sequential_two_agent/"
